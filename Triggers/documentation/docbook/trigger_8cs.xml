<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="trigger_8cs">
    <title>trigger.cs File Reference</title>
<para>Include dependency diagram for trigger.cs</para>
<para>
    <figure>
        <title>Dependency diagram</title>
        <mediaobject>
            <imageobject>
                <imagedata width="50%" align="center" valign="middle" scalefit="1" fileref="trigger_8cs__incl.png"></imagedata>
            </imageobject>
        </mediaobject>
    </figure>
</para>
<para>Included by dependency diagram for trigger.cs</para>
<para>
    <figure>
        <title>Dependency diagram</title>
        <mediaobject>
            <imageobject>
                <imagedata width="50%" align="center" valign="middle" scalefit="1" fileref="trigger_8cs__dep__incl.png"></imagedata>
            </imageobject>
        </mediaobject>
    </figure>
</para>
        <section>
            <title> Classes </title>
            <para>
                <itemizedlist>
                    <listitem>
                        <para>struct <link linkend="class_configure_one_flag_1_1_triggers">ConfigureOneFlag::Triggers</link></para>
<para><emphasis>&lt;summary&gt;
Primary entrypoint called from C1ORDER trigger for accessing C1 web service and returning/mapping data to SQL where appropriate
&lt;/summary&gt;</emphasis></para>
                    </listitem>
                </itemizedlist>
            </para>
        </section>
        <simplesect>
            <title> Namespaces </title>
            <para>
                <itemizedlist>
                    <listitem>
                        <para>struct <link linkend="namespace_configure_one_flag">ConfigureOneFlag</link></para>
                    </listitem>
                </itemizedlist>
            </para>
        </simplesect>
    <simplesect>
        <title>Detailed Description</title>
    <para>Definition in file C:/Users/hinesj/Documents/Visual Studio 2015/Projects/Triggers/Triggers/trigger.cs</para>
    </simplesect>
    <literallayout><computeroutput>
1 <emphasis class="keyword">using</emphasis>&#32;Microsoft.SqlServer.Server;
2 <emphasis class="keyword">using</emphasis>&#32;<link linkend="namespace_system">System</link>;
3 <emphasis class="keyword">using</emphasis>&#32;<link linkend="namespace_system">System</link>.Data.SqlClient;
4 
5 <emphasis class="keyword">namespace&#32;</emphasis><link linkend="namespace_configure_one_flag">ConfigureOneFlag</link>
6 {
10 &#32;&#32;&#32;&#32;<emphasis class="keyword">public</emphasis>&#32;<emphasis class="keyword">class&#32;</emphasis>Triggers
11 &#32;&#32;&#32;&#32;{
12 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keyword">public</emphasis>&#32;<emphasis class="keyword">static</emphasis>&#32;<emphasis class="keywordtype">string</emphasis>&#32;<link linkend="class_configure_one_flag_1_1_triggers_adb47d391c1eb7baeb5780f3dd9322a6d_1adb47d391c1eb7baeb5780f3dd9322a6d">wsReturn</link>;
13 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keyword">public</emphasis>&#32;<emphasis class="keyword">static</emphasis>&#32;<emphasis class="keywordtype">string</emphasis>&#32;<link linkend="class_configure_one_flag_1_1_triggers_ad424a8622609cf34218e92efc07b6870_1ad424a8622609cf34218e92efc07b6870">caller</link>&#32;=&#32;<emphasis class="stringliteral">&quot;&quot;</emphasis>;
14 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keyword">public</emphasis>&#32;<emphasis class="keyword">static</emphasis>&#32;<emphasis class="keywordtype">string</emphasis>&#32;<link linkend="class_configure_one_flag_1_1_triggers_a857274f8767a6571894105403ee8e26e_1a857274f8767a6571894105403ee8e26e">C1URL</link>;
<link linkend="class_configure_one_flag_1_1_triggers_aeb15437df6eb15652ae79ee607ccdc11_1aeb15437df6eb15652ae79ee607ccdc11">15 </link>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keyword">public</emphasis>&#32;<emphasis class="keyword">static</emphasis>&#32;<emphasis class="keywordtype">string</emphasis>&#32;<link linkend="class_configure_one_flag_1_1_triggers_aeb15437df6eb15652ae79ee607ccdc11_1aeb15437df6eb15652ae79ee607ccdc11">logSource</link>&#32;=&#32;<emphasis class="stringliteral">&quot;C1ORDER&quot;</emphasis>;
<link linkend="class_configure_one_flag_1_1_triggers_a3cd5e3e64a361f5e3a8d7fbd724a471f_1a3cd5e3e64a361f5e3a8d7fbd724a471f">16 </link>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keyword">public</emphasis>&#32;<emphasis class="keyword">static</emphasis>&#32;<emphasis class="keywordtype">string</emphasis>&#32;<link linkend="class_configure_one_flag_1_1_triggers_a3cd5e3e64a361f5e3a8d7fbd724a471f_1a3cd5e3e64a361f5e3a8d7fbd724a471f">logEvent</link>;
<link linkend="class_configure_one_flag_1_1_triggers_a1f5e29464bbb7305488f6fac0b1835ad_1a1f5e29464bbb7305488f6fac0b1835ad">17 </link>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keyword">public</emphasis>&#32;<emphasis class="keyword">static</emphasis>&#32;<emphasis class="keywordtype">string</emphasis>&#32;<link linkend="class_configure_one_flag_1_1_triggers_a1f5e29464bbb7305488f6fac0b1835ad_1a1f5e29464bbb7305488f6fac0b1835ad">logName</link>&#32;=&#32;<emphasis class="stringliteral">&quot;Application&quot;</emphasis>;
<link linkend="class_configure_one_flag_1_1_triggers_afd0957296af9cc27c0a677ba2c027bf1_1afd0957296af9cc27c0a677ba2c027bf1">18 </link>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keyword">public</emphasis>&#32;<emphasis class="keyword">static</emphasis>&#32;<emphasis class="keywordtype">string</emphasis>&#32;<link linkend="class_configure_one_flag_1_1_triggers_afd0957296af9cc27c0a677ba2c027bf1_1afd0957296af9cc27c0a677ba2c027bf1">pubOrderNumber</link>&#32;=&#32;<emphasis class="stringliteral">&quot;&quot;</emphasis>;
<link linkend="class_configure_one_flag_1_1_triggers_a9e9af4ac5f637116d47bcd5e2d12c2e1_1a9e9af4ac5f637116d47bcd5e2d12c2e1">19 </link>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keyword">public</emphasis>&#32;<emphasis class="keyword">static</emphasis>&#32;<emphasis class="keywordtype">string</emphasis>&#32;<link linkend="class_configure_one_flag_1_1_triggers_a9e9af4ac5f637116d47bcd5e2d12c2e1_1a9e9af4ac5f637116d47bcd5e2d12c2e1">dbEnvironment</link>&#32;=&#32;<emphasis class="stringliteral">&quot;&quot;</emphasis>;
<link linkend="class_configure_one_flag_1_1_triggers_a7152b65d47b96c0deebdad4f1b5e86c1_1a7152b65d47b96c0deebdad4f1b5e86c1">20 </link>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keyword">public</emphasis>&#32;<emphasis class="keyword">static</emphasis>&#32;<emphasis class="keywordtype">string</emphasis>&#32;<link linkend="class_configure_one_flag_1_1_triggers_a7152b65d47b96c0deebdad4f1b5e86c1_1a7152b65d47b96c0deebdad4f1b5e86c1">key</link>&#32;=&#32;<emphasis class="stringliteral">&quot;getOrder&quot;</emphasis>;
<link linkend="class_configure_one_flag_1_1_triggers_af96ea08f030e64ce8660fab49a24378d_1af96ea08f030e64ce8660fab49a24378d">21 </link>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keyword">public</emphasis>&#32;<emphasis class="keyword">static</emphasis>&#32;<emphasis class="keywordtype">string</emphasis>&#32;<link linkend="class_configure_one_flag_1_1_triggers_af96ea08f030e64ce8660fab49a24378d_1af96ea08f030e64ce8660fab49a24378d">xmlPayload</link>&#32;=&#32;<emphasis class="stringliteral">&quot;&quot;</emphasis>;
<link linkend="class_configure_one_flag_1_1_triggers_a333fd994019bc2afa23c7d70add609de_1a333fd994019bc2afa23c7d70add609de">22 </link>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keyword">public</emphasis>&#32;<emphasis class="keyword">static</emphasis>&#32;<emphasis class="keywordtype">string</emphasis>&#32;<link linkend="class_configure_one_flag_1_1_triggers_a333fd994019bc2afa23c7d70add609de_1a333fd994019bc2afa23c7d70add609de">orderValue</link>&#32;=&#32;<emphasis class="stringliteral">&quot;&quot;</emphasis>;
23 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;[SqlTrigger(Name&#32;=&#32;<emphasis class="stringliteral">&quot;C1Order&quot;</emphasis>,&#32;Target&#32;=&#32;<emphasis class="stringliteral">&quot;GR_Cfg_Queue&quot;</emphasis>,&#32;Event&#32;=&#32;<emphasis class="stringliteral">&quot;AFTER&#32;INSERT&quot;</emphasis>)]
<link linkend="class_configure_one_flag_1_1_triggers_a7446070eb1c5dd9f63f7043525014c9f_1a7446070eb1c5dd9f63f7043525014c9f">24 </link>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keyword">public</emphasis>&#32;<emphasis class="keyword">static</emphasis>&#32;<emphasis class="keywordtype">void</emphasis>&#32;<link linkend="class_configure_one_flag_1_1_triggers_a7446070eb1c5dd9f63f7043525014c9f_1a7446070eb1c5dd9f63f7043525014c9f">C1Order</link>()
25 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
26 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">if</emphasis>&#32;(!<link linkend="namespace_system">System</link>.Diagnostics.EventLog.SourceExists(<emphasis class="stringliteral">&quot;C1ORDER&quot;</emphasis>))
27 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
28 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="namespace_system">System</link>.Diagnostics.EventLog.CreateEventSource(
29 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="stringliteral">&quot;C1ORDER&quot;</emphasis>,&#32;<emphasis class="stringliteral">&quot;Application&quot;</emphasis>);
30 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
31 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;
32 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;logEvent&#32;=&#32;<emphasis class="stringliteral">&quot;TRIGGER&#32;-&#32;GR_CFG_QUEUE&#32;:&#32;INCOMING&#32;ORDER&quot;</emphasis>;
33 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">if</emphasis>&#32;(<link linkend="class_configure_one_flag_1_1_database_factory">DatabaseFactory</link>.<link linkend="class_configure_one_flag_1_1_database_factory_a6a42b60bab872801db70540311c4e2bc_1a6a42b60bab872801db70540311c4e2bc">debugLogging</link>)&#32;{&#32;<link linkend="namespace_system">System</link>.Diagnostics.EventLog.WriteEntry(logSource,&#32;logEvent,&#32;<link linkend="namespace_system">System</link>.Diagnostics.EventLogEntryType.Information,&#32;234);&#32;}
34 
35 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">switch</emphasis>&#32;(<link linkend="class_configure_one_flag_1_1_c1_dictionaries">C1Dictionaries</link>.<link linkend="class_configure_one_flag_1_1_c1_dictionaries_a192b4ea45e2b5d46ed02929db9c9d320_1a192b4ea45e2b5d46ed02929db9c9d320">webmethods</link>.ContainsKey(<emphasis class="stringliteral">&quot;getOrder&quot;</emphasis>))
36 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
37 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">case</emphasis>&#32;<emphasis class="keyword">false</emphasis>:
38 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="class_configure_one_flag_1_1_c1_dictionaries">C1Dictionaries</link>.<link linkend="class_configure_one_flag_1_1_c1_dictionaries_a5fbd06a46c2864f55b7b43946048c3b4_1a5fbd06a46c2864f55b7b43946048c3b4">LoadWMDictionary</link>();
39 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="class_configure_one_flag_1_1_c1_dictionaries">C1Dictionaries</link>.<link linkend="class_configure_one_flag_1_1_c1_dictionaries_ac09be8def5557047288f25a46fd85ed9_1ac09be8def5557047288f25a46fd85ed9">LoadDBFLengthDictionary</link>();
40 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">break</emphasis>;
41 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">default</emphasis>:
42 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="comment">//dictionary&#32;already&#32;loaded</emphasis>
43 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">break</emphasis>;
44 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
45 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;
46 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordtype">string</emphasis>&#32;orderNum;
47 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;orderValue&#32;=&#32;<emphasis class="stringliteral">&quot;&quot;</emphasis>;
48 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordtype">string</emphasis>&#32;qRowPointerValue&#32;=&#32;<emphasis class="stringliteral">&quot;&quot;</emphasis>;
49 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;SqlTriggerContext&#32;triggContext&#32;=&#32;SqlContext.TriggerContext;
50 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;SqlParameter&#32;orderNumber&#32;=&#32;<emphasis class="keyword">new</emphasis>&#32;SqlParameter(<emphasis class="stringliteral">&quot;@order_num&quot;</emphasis>,&#32;<link linkend="namespace_system">System</link>.Data.SqlDbType.NVarChar);
51 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;SqlParameter&#32;qRowPointer&#32;=&#32;<emphasis class="keyword">new</emphasis>&#32;SqlParameter(<emphasis class="stringliteral">&quot;@RowPointer&quot;</emphasis>,&#32;<link linkend="namespace_system">System</link>.Data.SqlDbType.NVarChar);
52 
53 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">switch</emphasis>&#32;(triggContext.TriggerAction&#32;==&#32;TriggerAction.Insert)
54 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
55 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">case</emphasis>&#32;<emphasis class="keyword">true</emphasis>:
56 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keyword">using</emphasis>&#32;(SqlConnection&#32;conn&#32;=&#32;<emphasis class="keyword">new</emphasis>&#32;SqlConnection(<emphasis class="stringliteral">&quot;context&#32;connection=true&quot;</emphasis>))
57 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
58 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;conn.Open();
59 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;SqlCommand&#32;sqlComm&#32;=&#32;<emphasis class="keyword">new</emphasis>&#32;SqlCommand();
60 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sqlComm.CommandTimeout&#32;=&#32;1800;
61 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;SqlPipe&#32;sqlP&#32;=&#32;SqlContext.Pipe;
62 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sqlComm.Connection&#32;=&#32;conn;
63 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sqlComm.CommandText&#32;=&#32;<emphasis class="stringliteral">&quot;SELECT&#32;order_num,&#32;RowPointer&#32;from&#32;INSERTED&quot;</emphasis>;
64 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;orderNumber.Value&#32;=&#32;sqlComm.ExecuteScalar().ToString();
65 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;orderValue&#32;=&#32;orderNumber.Value.ToString();
66 
67 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sqlComm.CommandText&#32;=&#32;<emphasis class="stringliteral">&quot;SELECT&#32;RowPointer&#32;from&#32;INSERTED&quot;</emphasis>;
68 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;qRowPointer.Value&#32;=&#32;sqlComm.ExecuteScalar().ToString();
69 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;qRowPointerValue&#32;=&#32;qRowPointer.Value.ToString();
70 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;
71 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;conn.Close();
72 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;logEvent&#32;=&#32;<emphasis class="stringliteral">&quot;INCOMING&#32;C1&#32;ORDER&#32;NUMBER:&#32;&quot;</emphasis>&#32;+&#32;<link linkend="class_configure_one_flag_1_1_triggers_a333fd994019bc2afa23c7d70add609de_1a333fd994019bc2afa23c7d70add609de">orderValue</link>;
73 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="namespace_system">System</link>.Diagnostics.EventLog.WriteEntry(logSource,&#32;logEvent,&#32;<link linkend="namespace_system">System</link>.Diagnostics.EventLogEntryType.Information,&#32;234);
74 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
75 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">break</emphasis>;
76 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">default</emphasis>:
77 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">return</emphasis>;
78 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
79 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;
80 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="comment">//Determine&#32;whether&#32;incoming&#32;order&#32;is&#32;production&#32;or&#32;dev/test</emphasis>
81 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordtype">string</emphasis>&#32;incomingOrder&#32;=&#32;orderValue.Substring(0,&#32;1);
82 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dbEnvironment&#32;=&#32;<emphasis class="stringliteral">&quot;DEV&quot;</emphasis>;
83 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">if</emphasis>&#32;(incomingOrder&#32;!=&#32;<emphasis class="stringliteral">&quot;D&quot;</emphasis>)
84 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
85 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dbEnvironment&#32;=&#32;<emphasis class="stringliteral">&quot;PROD&quot;</emphasis>;
86 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
87 
88 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordtype">string</emphasis>&#32;useMethod&#32;=&#32;<emphasis class="stringliteral">&quot;&quot;</emphasis>;
89 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">if</emphasis>&#32;(<link linkend="class_configure_one_flag_1_1_triggers">Triggers</link>.<link linkend="class_configure_one_flag_1_1_triggers_a9e9af4ac5f637116d47bcd5e2d12c2e1_1a9e9af4ac5f637116d47bcd5e2d12c2e1">dbEnvironment</link>&#32;==&#32;<emphasis class="stringliteral">&quot;PROD&quot;</emphasis>&#32;&amp;&amp;&#32;<link linkend="class_configure_one_flag_1_1_database_factory">DatabaseFactory</link>.<link linkend="class_configure_one_flag_1_1_database_factory_a7ea71eed70f97c7b89407ce8d2c84a27_1a7ea71eed70f97c7b89407ce8d2c84a27">dbprotect</link>&#32;!=&#32;<emphasis class="stringliteral">&quot;YES&quot;</emphasis>)&#32;{&#32;key&#32;=&#32;<emphasis class="stringliteral">&quot;getOrderPROD&quot;</emphasis>;&#32;}
90 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;
91 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">if</emphasis>&#32;(<link linkend="class_configure_one_flag_1_1_c1_dictionaries">C1Dictionaries</link>.<link linkend="class_configure_one_flag_1_1_c1_dictionaries_a192b4ea45e2b5d46ed02929db9c9d320_1a192b4ea45e2b5d46ed02929db9c9d320">webmethods</link>.ContainsKey(key))
92 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
93 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;useMethod&#32;=&#32;<link linkend="class_configure_one_flag_1_1_c1_dictionaries">C1Dictionaries</link>.<link linkend="class_configure_one_flag_1_1_c1_dictionaries_a192b4ea45e2b5d46ed02929db9c9d320_1a192b4ea45e2b5d46ed02929db9c9d320">webmethods</link>[<link linkend="class_configure_one_flag_1_1_triggers_a7152b65d47b96c0deebdad4f1b5e86c1_1a7152b65d47b96c0deebdad4f1b5e86c1">key</link>];
94 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;key&#32;=&#32;<emphasis class="stringliteral">&quot;getOrder&quot;</emphasis>;
95 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;C1URL&#32;=&#32;useMethod;
96 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
97 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;
98 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="class_configure_one_flag_1_1_database_factory">DatabaseFactory</link>&#32;dbf&#32;=&#32;<emphasis class="keyword">new</emphasis>&#32;<link linkend="class_configure_one_flag_1_1_database_factory">DatabaseFactory</link>();
99 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dbf.<link linkend="class_configure_one_flag_1_1_database_factory_ae1ec057e7696e9c9439a12e6988970d7_1ae1ec057e7696e9c9439a12e6988970d7">SetConnectionString</link>();
100 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;caller&#32;=&#32;<emphasis class="stringliteral">&quot;ORDER&quot;</emphasis>;
101 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;orderNum&#32;=&#32;<link linkend="class_configure_one_flag_1_1_triggers_a333fd994019bc2afa23c7d70add609de_1a333fd994019bc2afa23c7d70add609de">orderValue</link>;
102 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pubOrderNumber&#32;=&#32;orderNum;
103 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;
104 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;logEvent&#32;=&#32;<emphasis class="stringliteral">&quot;Connection&#32;String&#32;(Initial):&#32;&quot;</emphasis>&#32;+&#32;<link linkend="class_configure_one_flag_1_1_database_factory">DatabaseFactory</link>.<link linkend="class_configure_one_flag_1_1_database_factory_a97a9d57d4ff36a700cc5233c5fdb9ac5_1a97a9d57d4ff36a700cc5233c5fdb9ac5">connectionString</link>;
105 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">if</emphasis>&#32;(<link linkend="class_configure_one_flag_1_1_database_factory">DatabaseFactory</link>.<link linkend="class_configure_one_flag_1_1_database_factory_a6a42b60bab872801db70540311c4e2bc_1a6a42b60bab872801db70540311c4e2bc">debugLogging</link>)&#32;{&#32;<link linkend="namespace_system">System</link>.Diagnostics.EventLog.WriteEntry(logSource,&#32;logEvent,&#32;<link linkend="namespace_system">System</link>.Diagnostics.EventLogEntryType.Information,&#32;234);&#32;}
106 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;
107 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="comment">//Check&#32;if&#32;this&#32;order&#32;has&#32;already&#32;been&#32;completely&#32;processed:</emphasis>
108 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">if</emphasis>&#32;(<link linkend="class_configure_one_flag_1_1_database_factory">DatabaseFactory</link>.<link linkend="class_configure_one_flag_1_1_database_factory_a51459bb022678d9e0defecb0adb1ac15_1a51459bb022678d9e0defecb0adb1ac15">OrderCompleted</link>(orderNum))
109 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
110 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;logEvent&#32;=&#32;<emphasis class="stringliteral">&quot;Order#&#32;&quot;</emphasis>&#32;+&#32;orderNum&#32;+&#32;<emphasis class="stringliteral">&quot;&#32;has&#32;already&#32;been&#32;completed.&#32;&#32;Further&#32;processing&#32;aborted&quot;</emphasis>;
111 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="namespace_system">System</link>.Diagnostics.EventLog.WriteEntry(logSource,&#32;logEvent,&#32;<link linkend="namespace_system">System</link>.Diagnostics.EventLogEntryType.Warning,&#32;234);
112 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="class_configure_one_flag_1_1_send_mail">SendMail</link>.<link linkend="class_configure_one_flag_1_1_send_mail_a2e1c2d0826f023cb2684a2b9bbd74ad9_1a2e1c2d0826f023cb2684a2b9bbd74ad9">MailMessage</link>(logEvent,&#32;<emphasis class="stringliteral">&quot;Aborted&#32;Status-C&#32;Order&quot;</emphasis>);
113 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keywordflow">return</emphasis>;&#32;&#32;&#32;&#32;&#32;<emphasis class="comment">//abort</emphasis>
114 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
115 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;
116 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="comment">//Ensure&#32;the&#32;mE&#32;array&#32;is&#32;initialized,&#32;in&#32;case&#32;it&#32;is&#32;never&#32;addressed&#32;again&#32;before&#32;an&#32;array.clear&#32;is&#32;attempted</emphasis>
117 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="class_configure_one_flag_1_1_audit">Audit</link>.<link linkend="class_configure_one_flag_1_1_audit_a96123e9c36299a75a5b8fc39ed35e8a9_1a96123e9c36299a75a5b8fc39ed35e8a9">mE</link>&#32;=&#32;<emphasis class="keyword">new</emphasis>&#32;<emphasis class="keywordtype">string</emphasis>[50];
118 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="class_configure_one_flag_1_1_audit">Audit</link>.<link linkend="class_configure_one_flag_1_1_audit_a7daa677b70eb67ec0dd852af3bec3ed8_1a7daa677b70eb67ec0dd852af3bec3ed8">mEIndex</link>&#32;=&#32;0;
119 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;xmlPayload&#32;=&#32;<emphasis class="stringliteral">&quot;&lt;soap:Envelope&#32;xmlns:xsi=&quot;</emphasis>&#32;+&#32;(char)34&#32;+&#32;<emphasis class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</emphasis>&#32;+&#32;(<emphasis class="keywordtype">char</emphasis>)34&#32;+&#32;<emphasis class="stringliteral">&quot;&#32;xmlns:xsd=&quot;</emphasis>&#32;+&#32;(char)34&#32;+&#32;<emphasis class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</emphasis>&#32;+&#32;(<emphasis class="keywordtype">char</emphasis>)34&#32;+&#32;<emphasis class="stringliteral">&quot;&#32;xmlns:soap=&quot;</emphasis>&#32;+&#32;(char)34&#32;+&#32;<emphasis class="stringliteral">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</emphasis>&#32;+&#32;(<emphasis class="keywordtype">char</emphasis>)34&#32;+&#32;<emphasis class="stringliteral">&quot;&gt;&quot;</emphasis>&#32;+&#32;<emphasis class="stringliteral">&quot;&lt;soap:Body&gt;&lt;&quot;</emphasis>&#32;+&#32;key&#32;+&#32;<emphasis class="stringliteral">&quot;&#32;xmlns=&quot;</emphasis>&#32;+&#32;(char)34&#32;+&#32;<emphasis class="stringliteral">&quot;http://ws.configureone.com&quot;</emphasis>&#32;+&#32;(<emphasis class="keywordtype">char</emphasis>)34&#32;+&#32;<emphasis class="stringliteral">&quot;&gt;&lt;orderNum&gt;&quot;</emphasis>&#32;+&#32;orderNum&#32;+&#32;<emphasis class="stringliteral">&quot;&lt;/orderNum&gt;&lt;/&quot;</emphasis>&#32;+&#32;key&#32;+&#32;<emphasis class="stringliteral">&quot;&gt;&lt;/soap:Body&gt;&lt;/soap:Envelope&gt;&quot;</emphasis>;
120 
121 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="comment">//Begin&#32;order-processing&#32;as&#32;an&#32;async&#32;task&#32;and&#32;allow&#32;trigger&#32;to&#32;reset</emphasis>
122 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Action&#32;ProcessXMLAsync&#32;=&#32;<emphasis class="keyword">new</emphasis>&#32;Action(<link linkend="class_configure_one_flag_1_1_triggers_a246cde167d6b8c1ab05cf0acb22c79a7_1a246cde167d6b8c1ab05cf0acb22c79a7">BeginProcessing</link>);
123 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ProcessXMLAsync.BeginInvoke(<emphasis class="keyword">new</emphasis>&#32;AsyncCallback(MTresult&#32;=&gt;
124 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
125 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;(MTresult.AsyncState&#32;as&#32;Action).EndInvoke(MTresult);
126 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}),&#32;ProcessXMLAsync);
127 
128 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;logEvent&#32;=&#32;<emphasis class="stringliteral">&quot;De-coupled&#32;order-processing&#32;from&#32;trigger&#32;and&#32;resetting&#32;(&quot;</emphasis>&#32;+&#32;orderNum&#32;+&#32;<emphasis class="stringliteral">&quot;)&quot;</emphasis>;
129 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="namespace_system">System</link>.Diagnostics.EventLog.WriteEntry(logSource,&#32;logEvent,&#32;<link linkend="namespace_system">System</link>.Diagnostics.EventLogEntryType.Information,&#32;234);
130 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<link linkend="class_configure_one_flag_1_1_triggers_a246cde167d6b8c1ab05cf0acb22c79a7_1a246cde167d6b8c1ab05cf0acb22c79a7">131 </link>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis class="keyword">public</emphasis>&#32;<emphasis class="keyword">static</emphasis>&#32;<emphasis class="keywordtype">void</emphasis>&#32;<link linkend="class_configure_one_flag_1_1_triggers_a246cde167d6b8c1ab05cf0acb22c79a7_1a246cde167d6b8c1ab05cf0acb22c79a7">BeginProcessing</link>()
132 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
133 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="class_configure_one_flag_1_1_c1_web_service">C1WebService</link>.<link linkend="class_configure_one_flag_1_1_c1_web_service_ae826903f85694f4cf481680e115076f3_1ae826903f85694f4cf481680e115076f3">CallConfigureOne</link>(key,&#32;xmlPayload,&#32;C1URL);
134 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;logEvent&#32;=&#32;<emphasis class="stringliteral">&quot;PROCESSING&#32;COMPLETE&#32;FOR&#32;ORDER:&#32;&quot;</emphasis>&#32;+&#32;<link linkend="class_configure_one_flag_1_1_triggers_a333fd994019bc2afa23c7d70add609de_1a333fd994019bc2afa23c7d70add609de">orderValue</link>;
135 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="namespace_system">System</link>.Diagnostics.EventLog.WriteEntry(logSource,&#32;logEvent,&#32;<link linkend="namespace_system">System</link>.Diagnostics.EventLogEntryType.Information,&#32;234);
136 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="class_configure_one_flag_1_1_audit">Audit</link>.<link linkend="class_configure_one_flag_1_1_audit_ac9f5188a69320d3d419afed3499e2a26_1ac9f5188a69320d3d419afed3499e2a26">ProcessingCompleted</link>(logEvent);
137 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
138 &#32;&#32;&#32;&#32;}
139 }
    </computeroutput></literallayout>
</section>
